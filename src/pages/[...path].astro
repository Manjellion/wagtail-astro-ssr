---
import { getPageByPath } from "../lib/wagtail";
import PageBody from "../components/PageBody.astro";

const parts = Array.isArray(Astro.params.path)
  ? Astro.params.path
  : (Astro.params.path ? [Astro.params.path] : []);

const pathname = "/" + parts.filter(Boolean).join("/") + "/";

const page = await getPageByPath(pathname);
if (!page) {
  return new Response("Not found", { status: 404 });
}

const title = page.meta?.seo_title || page.title;
const desc = page.meta?.search_description || "";
const canonical = new URL(pathname, import.meta.env.PUBLIC_SITE_URL || Astro.site).toString();
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{title}</title>
    {desc && <meta name="description" content={desc} />}

    <link rel="canonical" href={canonical} />

    <!-- Basic social tags (good for sharing + AI snippets) -->
    <meta property="og:title" content={title} />
    {desc && <meta property="og:description" content={desc} />}
    <meta property="og:url" content={canonical} />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <main>
      <h1>{page.title}</h1>
      <PageBody blocks={page.body} />

      <!-- Lit: client-only custom elements (Astro 5+ recommended approach) -->
      <script type="module">
        import "../components/lit/my-counter";
      </script>
      <my-counter start="3"></my-counter>
    </main>
  </body>
</html>